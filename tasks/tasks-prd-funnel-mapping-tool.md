## Relevant Files

- `components/Canvas.tsx` - Componente principal do canvas infinito para desenhar funis e fluxogramas com drag & drop corrigido.
- `components/Sidebar.tsx` - Biblioteca de blocos arrastáveis/clicáveis completamente redesenhada com layout limpo.
- `components/MiniMap.tsx` - Mini mapa para navegação do canvas.
- `components/Header.tsx` - Header completo com navegação e gerenciamento real de projetos/pastas usando hooks Convex (UPDATED).
- `components/ExportMenu.tsx` - Exportação do canvas (PDF/PNG/JPG/JSON) e importação de fluxos.
- `components/ShareModal.tsx` - Compartilhamento de URL (mock).
- `components/Node.tsx` - Blocos/nodes customizáveis com composição de layers corrigida e tamanhos proporcionais.
- `components/ComposedBlockIcon.tsx` - Componente para composição de ícones base + overlay com z-index correto.
- `components/icons/` - Diretório com todos os 16 ícones SVG convertidos para React components.
- `lib/utils/canvasHelpers.ts` - Funções utilitárias para manipulação do canvas e serialização/deserialização de fluxos.
- `lib/utils/jsonSchema.ts` - Schema e helpers para exportação/importação JSON (compatível com n8n).
- `convex/schema.ts` - Enhanced database schema with proper folder-project relationships, soft delete, activity logging, and templates support.
- `convex/projects.ts` - Mutations e queries para gerenciamento de projetos.
- `convex/flows.ts` - Mutations e queries para salvar/carregar flows (nodes e edges).
- `convex/folders.ts` - Complete CRUD mutations and queries for real folder management with validation, hierarchy support, and soft delete (NEW)
- `convex/validations.ts` - Comprehensive validation functions for folder names, project data, and all input sanitization (NEW)
- `hooks/useConvex.ts` - Hook personalizado para integração com Convex backend.
- `hooks/useCanvasSync.ts` - Hook para auto-save com debouncing e sincronização canvas-Convex.
- `hooks/useProjects.ts` - Custom hook for project management with real Convex integration (FIXED)
- `hooks/useFolders.ts` - Custom hook for folder management with real-time updates (FIXED)
- `contexts/ProjectContext.tsx` - Context para gerenciamento de estado do projeto atual.
- `contexts/ConvexProvider.tsx` - Wrapper para Convex client com configuração adequada.
- `components/modals/CreateFolderModal.tsx` - Modal for creating new folders with real Convex integration (FIXED)
- `components/modals/CreateProjectModal.tsx` - Modal for creating new projects with real Convex integration (FIXED)
- `components/modals/EditProjectModal.tsx` - Modal for editing existing project details (NEW)
- `components/modals/DeleteConfirmModal.tsx` - Confirmation modal for delete operations (NEW)
- `components/ProjectDropdown.tsx` - Refactored dropdown with real data and proper styling (NEW)
- `components/ProjectList.tsx` - List component for displaying projects with filters and actions (NEW)
- `components/FolderTabs.tsx` - Folder navigation tabs with real data and counts (NEW)
- `lib/utils/projectHelpers.ts` - Utility functions for project operations and validation (NEW)
- `lib/utils/folderHelpers.ts` - Utility functions for folder operations and color management (NEW)
- `styles/` - Estilos globais e de componentes (Tailwind ou shadcn/ui).
- `app/MainAppClient.tsx` - Componente principal da aplicação integrando Header, Sidebar e Canvas com estado de projeto.

### Notes

- Unit tests should typically be placed alongside the code files they are testing (e.g., `MyComponent.tsx` and `MyComponent.test.tsx` in the same directory).
- Use `npx jest [optional/path/to/test/file]` to run tests. Running without a path executes all tests found by the Jest configuration.
- All NEW components will use Convex real-time queries for automatic updates
- Implement proper loading states and error handling throughout
- Use optimistic updates where appropriate for better UX
- Follow existing design system and theme integration
- **CRITICAL FIX APPLIED**: Modal-Backend integration now working properly - pastas e projetos são criados no Convex e refletidos na UI em tempo real

## Tasks

- [x] 1.0 Implement Infinite Canvas and Node System
- [x] 2.0 Build Sidebar with Draggable/Clickable Blocks
- [x] 3.0 Add Mini Map for Canvas Navigation
- [x] 4.0 Create Header with Project/Folder Mock Management
- [x] 5.0 Implement Export, Import, and Share Functionality
- [x] 6.0 Implement Data Persistency with Convex Backend
- [ ] 7.0 UI/UX Improvements and Dark Mode Implementation
- [ ] 8.0 Enhanced Branding and Dark Theme Overhaul
- [x] 9.0 Implement Real Project and Folder Management System
- [ ] 10.0 Create Advanced Project Management Features
- [ ] 11.0 Implement Project Import/Export and Collaboration
- [ ] 12.0 Add Comprehensive Error Handling and Performance Optimization

---

### Sub-Tasks

- [x] 1.0 Implement Infinite Canvas and Node System
  - [x] 1.1 Infinite canvas component using React Flow
  - [x] 1.2 Basic node types (blocks, triggers, etc.)
  - [x] 1.3 Node connections and flow logic
  - [x] 1.4 Implement selection, multi-select, and node editing (text, color, etc.)
  - [x] 1.5 Handle edge cases (invalid connections, dragging outside canvas)
  - [x] 1.6 Add keyboard navigation and accessibility features

- [x] 2.0 Build Sidebar with Draggable/Clickable Blocks
  - [x] 2.1 Create pre-made blocks library with SVG icons converted to React components
    - [x] Convert all 16 SVG files to React components:
      - [x] ThankyouIcon.tsx (thank you page interface)
      - [x] UserIcon.tsx (user profile interface)  
      - [x] PostIcon.tsx (content/blog post interface)
      - [x] PopupIcon.tsx (popup/modal interface)
      - [x] CommentsIcon.tsx (comments/feedback interface)
      - [x] CTA1Icon.tsx (call-to-action with video player)
      - [x] CTA2Icon.tsx (call-to-action variant 2)
      - [x] CTA3Icon.tsx (call-to-action variant 3)
      - [x] ScreenIcon.tsx (base screen template)
      - [x] UrlIcon.tsx (URL redirect interface)
      - [x] SurveyIcon.tsx (survey/form interface)
      - [x] SignupIcon.tsx (registration form interface)
      - [x] CheckoutIcon.tsx (payment/checkout interface)
      - [x] GenericIcon.tsx (generic page template)
      - [x] CalendarIcon.tsx (calendar/scheduling interface)
      - [x] DownloadIcon.tsx (download/file interface)
    - [x] Update Sidebar.tsx to use React components instead of direct SVG imports
    - [x] Fixed TypeScript compatibility and import paths
    - [x] Verified all components render correctly in development environment
  - [x] 2.2 Implement drag-and-drop from sidebar to canvas
    - [x] Fixed drag-and-drop data transfer to correctly pass node type and properties
    - [x] Improved sidebar layout with proper spacing and grid layout (2x2 for funnel steps)
    - [x] Enhanced visual design with better borders, shadows, and hover effects
    - [x] Increased icon sizes from 56px to 80px for better visibility
    - [x] Improved node rendering with specific layouts for funnel steps vs traditional blocks
    - [x] Fixed node selection visual feedback with proper borders and shadows
    - [x] Enhanced ComposedBlockIcon component for better icon composition
    - [x] Added proper TypeScript interfaces for custom node properties
    - [x] Implemented correct icon mapping for each funnel step type
  - [x] 2.3 Click-to-add blocks functionality
    - [x] Both drag-and-drop and click-to-add work correctly
    - [x] Proper node type identification and rendering
    - [x] Correct label display and editing functionality
  - [x] 2.4 Fix proportions and visual issues (HOTFIX)
    - [x] **Nodes Resized**: Funnel steps now 100x120px (down from 160x200px) 
    - [x] **Traditional blocks**: 80x30px (down from 140x60px)
    - [x] **SVG Layers Fixed**: Removed interfering white background, proper z-index (base: 1, overlay: 2)
    - [x] **Sidebar Redesigned**: Clean layout with 208px width, proper tabs, better spacing
    - [x] **Icon Sizes**: Sidebar icons 24px, canvas icons 50px (proper proportions)
    - [x] **Labels Positioning**: Labels now positioned below icons with backdrop-blur background
    - [x] **Selection Visual**: Removed misaligned rectangles, added ring-based selection
    - [x] **Drag & Drop Fixed**: Added proper error handling and console logging
    - [x] **TypeScript Fixed**: Corrected drag event types and Canvas interfaces
  - [x] 2.5 Final proportions and functionality corrections (FINAL FIX)
    - [x] **Node Sizes Updated**: Funnel steps now 105x135px (as requested by user)
    - [x] **Sidebar Width**: Increased to 220px for better spacing
    - [x] **Grid Spacing**: Added proper 4px gaps between sidebar elements
    - [x] **Grid Alignment**: Fixed 2x2 grid alignment with proper padding
    - [x] **SVG Layer Positioning**: Fixed z-index hierarchy (base: 10, overlay: 20, label: 30)
    - [x] **Drag & Drop Circular JSON Error**: Fixed by creating serializable drag data objects
    - [x] **Selection Visual**: Proper separation of layers with correct spacing
    - [x] **Icon Sizes**: Optimized to 32px in sidebar, 64px in canvas for better visibility
    - [x] **Component Integration**: Updated MainAppClient.tsx to work with new interfaces
    - [x] **TypeScript Errors**: Fixed all linter errors and type definitions
  - [x] 2.6 CRITICAL FIXES
    - [x] **Edges Animados**: Linhas pontilhadas azuis com animação contínua
    - [x] **Prevenção de Auto-conexão**: Nodes não podem se conectar a si mesmos
    - [x] **Prevenção de Duplicatas**: Evita conexões duplicadas entre os mesmos nodes
    - [x] **Estilo Personalizado**: Stroke azul (#2563eb), largura 2px, dash pattern 6-4
    - [x] **Toggle Funcional**: Checkbox para ligar/desligar snap to grid
    - [x] **Grid 16x16**: Espaçamento otimizado para alinhamento
    - [x] **Controles Visuais**: Barra de controles no topo do canvas
    - [x] **Estado Persistente**: Mantém configuração durante a sessão
    - [x] **Data Transfer Duplo**: JSON + text/plain para compatibilidade
    - [x] **Logging Melhorado**: Emojis para debug visual (🚀✅❌)
    - [x] **Error Handling**: Try/catch em todas as operações
    - [x] **Accessibility**: ARIA labels e role="button"
    - [x] **Tamanho Exato**: Node container 105x135px = SVG size
    - [x] **Zero Padding**: Eliminado espaço entre SVG e máscara
    - [x] **Posicionamento Absoluto**: SVG preenche 100% do container
    - [x] **Labels Externos**: Posicionados -bottom-6 para não interferir
    - [x] **Ring Selection**: Seleção externa com ring-offset-2
    - [x] **Overlay Centralizado**: Ícones perfeitamente centralizados no screen
    - [x] **Handles Otimizados**: Tamanhos adequados (3x3px funnel, 2x2px blocos)
    - [x] **Background Grid**: 16px gap para melhor visualização
    - [x] **Controls Bar**: Interface limpa com instruções para o usuário
    - [x] **Add Node Button**: Botão para adicionar nodes programaticamente
    - [x] **Pan & Zoom**: Controles de navegação melhorados
    - [x] **Node Extent**: Área limitada para evitar nodes perdidos
    - [x] **Mini Map**: Navegação visual do canvas
  - [x] 2.7 Perfect SVG-Container Size Match
    - [x] **ScreenIcon Resized**: Exact 105x135px dimensions
    - [x] **Container Match**: Removed padding/borders for seamless appearance
    - [x] **preserveAspectRatio**: Added "none" for perfect scaling
    - [x] **Visual Unity**: SVG and container appear as single element
  - [x] 2.8 Fix Critical Connection and Visual Issues (PRIORITY 1)
    - [x] 2.8.1 Restore connection handles visibility and functionality
    - [x] 2.8.2 Fix node labels disappearing on canvas
    - [x] 2.8.3 Fix drag & drop functionality from sidebar to canvas
  - [x] 2.9 Enhance Inner SVG Content (PRIORITY 2)
    - [x] 2.9.1 Increase overlay icon size by 4x within screen boundaries
    - [x] 2.9.2 Ensure proper spacing and visual balance
    - [x] 2.9.3 Maintain responsive scaling
  - [x] 2.10 Implement Edge Deletion Functionality (PRIORITY 2)
    - [x] 2.10.1 Add click-to-delete edges functionality
    - [x] 2.10.2 Add keyboard shortcut for edge deletion (Delete/Backspace)
    - [x] 2.10.3 Add visual feedback for edge selection/hover
    - [x] 2.10.4 Implement edge context menu with delete option
  - [ ] 2.11 Implement Node Properties Panel (PRIORITY 3)
    - [ ] 2.11.1 Create right sidebar panel component
    - [ ] 2.11.2 Add node selection state management
    - [ ] 2.11.3 Implement name editing functionality
    - [ ] 2.11.4 Add color picker for node customization
    - [ ] 2.11.5 Add connector direction toggle (horizontal/vertical)
    - [ ] 2.11.6 Integrate panel with node selection events

- [x] 3.0 Add Mini Map for Canvas Navigation
  - [x] 3.1 Implement a mini map component synchronized with the main canvas
  - [x] 3.2 Allow navigation and zoom via the mini map
  - [x] 3.3 Ensure responsiveness and accessibility

- [x] 4.0 Create Header with Project/Folder Mock Management
  - [x] 4.1 Implement header layout and navigation
  - [x] 4.2 Add mock project/folder creation, selection, and deletion (UI only)
  - [x] 4.3 Display current project/folder name and status

- [x] 5.0 Implement Export, Import, and Share Functionality
  - [x] 5.1 Implement export of canvas as PDF, PNG, and JPG
  - [x] 5.2 Implement export of flow as JSON (n8n-compatible schema)
  - [x] 5.3 Implement import of flow from JSON (n8n-compatible schema)
  - [x] 5.4 Implement share modal for mock URL sharing
  - [x] 5.5 Handle export/import errors and edge cases (empty canvas, invalid JSON)

- [x] 6.0 Implement Data Persistency with Convex Backend
  - [x] 6.1 Setup Convex Schema for Projects, Flows, Nodes and Edges
  - [x] 6.2 Implement Convex mutations for saving/updating project data
  - [x] 6.3 Implement Convex queries for loading project data
  - [x] 6.4 Integrate real-time synchronization in Canvas component
  - [x] 6.5 Add auto-save functionality with debouncing
  - [x] 6.6 Implement project management with Convex backend
  - [x] 6.7 Add loading states and error handling for backend operations
  - [x] 6.8 Migrate existing mock data to Convex database

- [ ] 7.0 UI/UX Improvements and Dark Mode Implementation
  - [x] 7.1 Fix Layout Issues
    - [x] 7.1.1 Remove duplicate "Flow X" title from canvas area
    - [x] 7.1.2 Fix sidebar whitespace and alignment issues
    - [x] 7.1.3 Remove excessive right margin from canvas
    - [x] 7.1.4 Make canvas use full available screen space
    - [ ] 7.1.5 Fix scrolling issues with mini map visibility
  - [ ] 7.2 Implement Dark Mode Theme System
    - [x] 7.2.1 Create theme context and provider
    - [x] 7.2.2 Design Monokai/Dracula inspired dark color palette
    - [x] 7.2.3 Create light mode color palette for contrast
    - [x] 7.2.4 Add theme toggle button in header
    - [x] 7.2.5 Apply dark theme to Header component
    - [x] 7.2.6 Apply dark theme to Sidebar component
    - [ ] 7.2.7 Apply dark theme to Canvas and controls
    - [ ] 7.2.8 Apply dark theme to all modals (Export, Share, etc.)
    - [ ] 7.2.9 Ensure proper contrast and accessibility in both themes
  - [ ] 7.3 Enhanced Visual Design
    - [ ] 7.3.1 Improve component spacing and typography
    - [ ] 7.3.2 Add subtle animations and transitions
    - [ ] 7.3.3 Enhance icons and visual hierarchy
    - [ ] 7.3.4 Polish overall aesthetic consistency

- [ ] 8.0 Enhanced Branding and Dark Theme Overhaul
  - [x] 8.1 Replace Current Logo with Official SVG Assets
    - [x] 8.1.1 Copy SVG logos from /Assets/logos to components
    - [x] 8.1.2 Create React components for flowX_logo.svg and Flow_x_logo_Fav_Icon.svg
    - [x] 8.1.3 Replace text-based logo in Header with SVG logo component
    - [ ] 8.1.4 Update favicon with official icon
  - [x] 8.2 Implement Splash Screen with Animated Logo
    - [x] 8.2.1 Create SplashScreen component with logo glow animation
    - [x] 8.2.2 Add CSS animations for logo entrance and glow effects
    - [x] 8.2.3 Implement auto-close timer and fade transition to main app
    - [x] 8.2.4 Integrate splash screen with app initialization
  - [x] 8.3 Enhanced Dark Theme with Complementary Colors
    - [x] 8.3.1 Redesign color palette with darker greys (closer to black)
    - [x] 8.3.2 Create complementary colors for red X accent (#D73120)
    - [x] 8.3.3 Update ThemeContext with new enhanced dark theme
    - [ ] 8.3.4 Apply new colors to all components (Canvas, Header, Sidebar, Modals)
    - [ ] 8.3.5 Ensure proper contrast and accessibility compliance
  - [x] 8.4 Implement Enhanced UX Color Palette (Based on Color Guide)
    - [x] 8.4.1 Update ThemeContext with optimized dark theme colors
    - [x] 8.4.2 Replace heavy red (#D73120) with softer coral (#FE5F55) for UI elements
    - [x] 8.4.3 Add complementary colors (green #6EEB83, orange #FFAE03) from user palette
    - [x] 8.4.4 Fix edge connection confusion: green for normal, red only for delete
    - [x] 8.4.5 Keep original red (#D73120) only for logo and danger states
    - [x] 8.4.6 Apply changes to both light and dark themes
    - [ ] 8.4.7 Test accessibility and contrast ratios with new colors

- [x] 9.0 Implement Real Project and Folder Management System
  - [x] 9.1 Update Convex Backend for Real Project/Folder Management
    - [x] 9.1.1 Update convex/schema.ts with proper folder and project relationships
    - [x] 9.1.2 Create convex/folders.ts with CRUD mutations and queries
    - [x] 9.1.3 Update convex/projects.ts with folder relationships and advanced queries
    - [x] 9.1.4 Add validation functions for folder names and project data
    - [x] 9.1.5 Create database indexes for efficient querying by folder and status
    - [x] 9.1.6 Implement soft delete functionality for projects and folders
  - [x] 9.2 Create Project and Folder Management Hooks
    - [x] 9.2.1 Create hooks/useFolders.ts with real-time folder management
    - [x] 9.2.2 Update hooks/useProjects.ts with folder filtering and advanced queries
    - [x] 9.2.3 Implement optimistic updates for better UX in both hooks
    - [x] 9.2.4 Add error handling and retry logic for failed operations
    - [x] 9.2.5 Create useProjectSync hook for canvas-project synchronization
    - [ ] 9.2.6 Add loading states and caching mechanisms
  - [ ] 9.3 Build Complete Modal System for CRUD Operations
    - [x] 9.3.1 Create components/modals/ directory structure
    - [x] 9.3.2 Build CreateFolderModal with name validation and color picker
    - [x] 9.3.3 Build CreateProjectModal with folder selection and template options
    - [x] 9.3.4 Build EditProjectModal with all project properties (name, description, folder, status, priority)
    - [x] 9.3.5 Build EditFolderModal for editing folder name and color
    - [x] 9.3.6 Build DeleteConfirmModal with warning messages and confirmation
    - [x] 9.3.7 Integrate modals into Header.tsx and fix real data synchronization - COMPLETED: Fixed hooks to use real Convex data, updated modals to call actual mutations, integrated Header with real-time data display
    - [ ] 9.3.8 Fix project creation folder assignment (projects not being assigned to selected folder)
    - [ ] 9.3.9 Fix modal positioning and prevent element overflow
    - [ ] 9.3.10 Add keyboard navigation and accessibility features
    - [ ] 9.3.11 Implement modal state management and proper cleanup
  - [ ] 9.4 Implement Real Project Selection and Canvas Integration
    - [ ] 9.4.1 Update ProjectContext to use real Convex data and project selection
    - [ ] 9.4.2 Implement project selection dropdown in Header with real data
    - [ ] 9.4.3 Connect Canvas component to selected project (load/save flows based on project)
    - [ ] 9.4.4 Create project switching functionality with auto-save
    - [ ] 9.4.5 Update Canvas component to respond to project changes
    - [ ] 9.4.6 Implement canvas reset when switching projects
    - [ ] 9.4.7 Add loading indicators during project switching
    - [ ] 9.4.8 Handle edge cases like deleted projects and access errors
    - [x] 9.4.9 Fix Canvas auto-save integration with Convex (flows not being saved) - COMPLETED: Rewritten useCanvasSync to use Convex queries/mutations, added createFlow mutation, implemented real-time flow persistence
    - [x] 9.4.10 Fix Critical Auto-Save Bug - HOTFIX: Removed nodes.length === 0 condition that was preventing empty flows from being saved
    - [ ] 9.4.11 Implement real folder filtering in project dropdown

- [ ] 10.0 Create Advanced Project Management Features
  - [ ] 10.1 Implement Advanced Search and Filtering
    - [ ] 10.1.1 Implement project search functionality
    - [ ] 10.1.2 Add project sorting by date, name, and status
    - [ ] 10.1.3 Create project status management (active, draft, archived)
    - [ ] 10.1.4 Add project filtering by folder and multiple criteria
  - [ ] 10.2 Project Operations and Management
    - [ ] 10.2.1 Implement project duplication feature
    - [ ] 10.2.2 Add project statistics and metadata display
    - [ ] 10.2.3 Create bulk operations for multiple projects
    - [ ] 10.2.4 Implement project favorites and recent projects
  - [ ] 10.3 Templates and Quick-Start Features
    - [ ] 10.3.1 Add project templates and quick-start options
    - [ ] 10.3.2 Create predefined funnel templates (Lead Gen, Sales, etc.)
    - [ ] 10.3.3 Implement template preview and selection system
    - [ ] 10.3.4 Add custom template creation and sharing

- [ ] 11.0 Implement Project Import/Export and Collaboration
  - [ ] 11.1 Enhanced Export/Import System
    - [ ] 11.1.1 Create project export functionality with complete data
    - [ ] 11.1.2 Implement project import with validation and conflict resolution
    - [ ] 11.1.3 Add project sharing via URL generation
    - [ ] 11.1.4 Create project backup and restore system
  - [ ] 11.2 Collaboration and Versioning
    - [ ] 11.2.1 Implement project versioning and history
    - [ ] 11.2.2 Add collaboration features preparation
    - [ ] 11.2.3 Create project analytics and usage tracking
    - [ ] 11.2.4 Implement project access control and permissions
  - [ ] 11.3 Data Migration and Seed Enhancement
    - [ ] 11.3.1 Update convex/seedData.ts with realistic folder and project data
    - [ ] 11.3.2 Create migration functions for existing mock data
    - [ ] 11.3.3 Implement data consistency checks and validation
    - [ ] 11.3.4 Add development data reset functionality
    - [ ] 11.3.5 Create sample project templates with realistic flows
    - [ ] 11.3.6 Update AdminPanel to work with new data structure

- [ ] 12.0 Add Comprehensive Error Handling and Performance Optimization
  - [ ] 12.1 Error Handling and User Experience
    - [ ] 12.1.1 Implement comprehensive error boundaries for project operations
    - [ ] 12.1.2 Add loading skeletons for all project-related components
    - [ ] 12.1.3 Create error messages and retry mechanisms
    - [ ] 12.1.4 Add toast notifications for operations success/failure
    - [ ] 12.1.5 Create fallback UI for when projects fail to load
  - [ ] 12.2 Performance and Scalability
    - [ ] 12.2.1 Implement offline support and sync conflict resolution
    - [ ] 12.2.2 Implement rate limiting and quota management
    - [ ] 12.2.3 Add pagination for large project lists
    - [ ] 12.2.4 Optimize real-time queries for better performance
  - [ ] 12.3 Monitoring and Analytics
    - [ ] 12.3.1 Add comprehensive logging for debugging
    - [ ] 12.3.2 Implement performance monitoring
    - [ ] 12.3.3 Create usage analytics dashboard
    - [ ] 12.3.4 Add error tracking and reporting system 